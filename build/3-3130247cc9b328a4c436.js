(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{486:function(e,t,n){"use strict";var a=n(204),r=n.n(a),o=n(1),i=n.n(o),c=n(479),l=n.n(c),s=(n(480),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}),u=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var p=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.addReply=t.addReply.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i.a.Component),u(n,[{key:"addReply",value:function(){var e=this.editorInstance.getContent("html");this.props.publishRichText(e),this.editorInstance.setContent("","html")}},{key:"render",value:function(){var t=this,e=this.props.richTextSet;return i.a.createElement("div",null,i.a.createElement("div",{className:"rich-text"},i.a.createElement(l.a,s({},e,{ref:function(e){return t.editorInstance=e}}))),i.a.createElement(r.a,{type:"primary",onClick:this.addReply,className:"mt20"},"回复"))}}]),n}();t.a=p},492:function(e,t,n){"use strict";n.r(t);var a=n(204),r=n.n(a),o=n(478),i=n.n(o),c=n(122),l=n.n(c),s=n(1),u=n.n(s),p=n(123),f=n.n(p),m=n(16),h=(n(477),n(124)),y=n(32),b=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var d=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={replyId:t.props.comment.id,upsLength:t.props.comment.ups.length},t.goodReply=t.goodReply.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,u.a.Component),b(n,[{key:"goodReply",value:function(){if(!y.a.isLogin())return l.a.error("请登录再进行操作"),!1;var e=h.a.GOOD_REPLY.replace("{replyId}",this.props.comment.id),t=this;f.a.post(e,{accesstoken:localStorage.getItem("userToken")}).then(function(e){"down"==e.data.action?t.setState({upsLength:t.state.upsLength-1}):t.setState({upsLength:t.state.upsLength+1})}).catch(function(e){l.a.error(e.response.data.error_msg)})}},{key:"render",value:function(){var e=this.props,t=e.comment,n=e.floor;return u.a.createElement("li",{className:"item"},u.a.createElement(m.b,{title:t.author.loginname,className:"float-left",to:"/user/"+t.author.loginname},u.a.createElement("img",{src:t.author.avatar_url})),u.a.createElement("div",{className:"item-content"},u.a.createElement("div",{className:"item-content-title"},u.a.createElement("span",null,t.author.loginname),u.a.createElement("span",{className:"comment-floor"},n+1,"楼")),u.a.createElement("div",{className:"item-content-body"},u.a.createElement("p",{dangerouslySetInnerHTML:{__html:t.content}})),u.a.createElement("div",{className:"item-content-meta"},u.a.createElement("span",{onClick:this.goodReply},u.a.createElement("i",{className:"iconfont icon-dianzan",title:"点赞数:"+this.state.upsLength}),this.state.upsLength),u.a.createElement("span",null,u.a.createElement("i",{className:"iconfont icon-huifu",title:"回复",onClick:this.addReply}),"回复"),u.a.createElement("span",null,u.a.createElement("i",{className:"iconfont icon-shijian",title:"创建时间:"+y.a.formatTime(t.create_at)}),y.a.formatTime(t.create_at)))))}}]),n}(),g=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var E=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.a.Component),g(t,[{key:"render",value:function(){var e=this.props.commentList;return u.a.createElement("ul",null,e&&e.map(function(e,t){return u.a.createElement(d,{key:t,comment:e,floor:t})}))}}]),t}(),v=n(486),_=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var T=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={topicId:t.props.match.params.id,topicInfo:{},loading:!0},t.getTopicDetail=t.getTopicDetail.bind(t),t.collectTopic=t.collectTopic.bind(t),t.publishRichText=t.publishRichText.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,u.a.Component),_(n,[{key:"getTopicDetail",value:function(e){this.setState({loading:!0});var t=h.a.GET_TOPIC_DETAIL.replace("{topicId}",this.state.topicId),n=this;f.a.get(t,{params:e}).then(function(e){n.setState({topicInfo:e.data.data,loading:!1})}).catch(function(e){n.setState({loading:!1}),l.a.error(e)})}},{key:"componentWillMount",value:function(){this.getTopicDetail({mdrender:"true",accesstoken:localStorage.getItem("userToken")})}},{key:"collectTopic",value:function(){var t=this;if(!y.a.isLogin())return l.a.error("请登录再进行操作"),!1;var e=this.state.topicInfo.is_collect?"DE_COLLECT_TOPIC":"COLLECT_TOPIC",n=h.a[e];f.a.post(n,{topic_id:this.state.topicId,accesstoken:localStorage.getItem("userToken")}).then(function(e){t.getTopicDetail({mdrender:"true",accesstoken:localStorage.getItem("userToken")})}).catch(function(e){l.a.error(e)})}},{key:"publishRichText",value:function(e){var t=this;if(!y.a.isLogin())return l.a.error("请登录再进行操作"),!1;var n=h.a.NEW_REPLY.replace("{topicId}",this.state.topicId);f.a.post(n,{accesstoken:localStorage.getItem("userToken"),content:e}).then(function(e){t.getTopicDetail({mdrender:"true",accesstoken:localStorage.getItem("userToken")})}).catch(function(e){l.a.error(e.response&&e.response.data.error_msg||"服务端出错")})}},{key:"render",value:function(){var e=this.state.topicInfo,t=this.state.topicInfo.is_collect;return this.state.loading?u.a.createElement(i.a,{tip:"正在加载...",size:"large"}):u.a.createElement("div",null,u.a.createElement("h3",{className:"block-title mt20"},u.a.createElement(m.b,{to:"/"},"首页"),u.a.createElement("span",{className:"bread-split"},"/"),"信息区"),e.title&&u.a.createElement("div",{className:"topic-detail-head"},u.a.createElement("h2",null,e.title),u.a.createElement(r.a,{type:"primary",style:{position:"absolute",right:"10px",top:"10px"},onClick:this.collectTopic},t?"取消收藏":"收藏"),u.a.createElement("p",null,u.a.createElement("span",null,"作者 : ",e.author.loginname),u.a.createElement("span",null,"创建时间 : ",y.a.formatTime(e.create_at)),u.a.createElement("span",null,"阅读数 : ",e.visit_count),u.a.createElement("span",null,"最近回复时间 : ",y.a.formatTime(e.last_reply_at)))),u.a.createElement("h3",{className:"block-title mt20"},"内容区"),u.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.content},className:"md"}),u.a.createElement("h3",{className:"block-title mt20"},"回复区：共",e.reply_count,"条回复"),0<e.reply_count?u.a.createElement(E,{commentList:e.replies}):u.a.createElement("div",{className:"item",style:{lineHeight:"34px"}},"暂无回复"),u.a.createElement("h3",{className:"block-title mt20"},"添加回复"),u.a.createElement(v.a,{richTextSet:{height:260},publishRichText:this.publishRichText}))}}]),n}();t.default=T}}]);